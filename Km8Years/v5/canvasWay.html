<!DOCTYPE html>
<html lang="en"  style="width:100%; height: 100%">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body style="width:100%; height: 100%; margin: 0 ; overflow: hidden">
<canvas id="canvas" width="100%" height="100%" style="border:none">
    换个浏览器试试呗~.
</canvas>

<script src="../js/jquery-3.0.0.js"></script>
<script>
//重要;全局无离屏canvas缓存，后边要加上http://www.cnblogs.com/axes/p/3567364.html

    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext('2d');
    var km8years = {
        //画面所需要配置的资源及参量
        source : {
            //所需加载的图像资源
            img : [
                '../img/2.png',
                '../img/ufo1.png',
                '../img/ufo2.png',
                '../img/starBg.png',
//                '../img/starBg-big.png',
//                '../img/starBgCenter.png',
                '../img/info.png',
                '../img/astronaut.png',
                '../img/finalScreenMarker.png',
                '../img/arrow.png'
            ],
            shakeHeadAngle : -15,
            //飞船及用户头像偏移量
            offset : [100,100],
            //头部和飞船相对值
            border : [270, 260],
            //像素计，每屏幕展示的bg的宽度
            bgShowPerScreen : 2000,
            //文字对话框的显示位置和背景图中的xy轴值,二维数组，显示位置的坐标
            infoPosition : [
                //第一屏相对于核心内容区域的坐标
                [995,372],
                [1038,296],
                [1015,358],
                [1013,357],
                [1042,331]
            ],
            infoLine : {
                marginTop : 90,
                marginLeft : 70,
                lineSpacing : 40
            },
            infotext : [[{"text":"2008\u5e7410\u6708\uff0cKM\u5e73\u53f0\u6b63\u5f0f\u4e0a\u7ebf\u8fd0\u8425\uff0c","type":22,"wrap":1},{"text":"\u76ee\u524d\u5df2\u67098\u5e74\u3002","type":22,"wrap":1},{"text":"","type":22,"wrap":1},{"text":"\u4f60\u4e8e","type":22,"wrap":0},{"text":"2015\u5e7407\u670814\u65e5","type":26,"wrap":1},{"text":"\u9996\u6b21\u4f7f\u7528KM\uff0c\u8fc4\u4eca\u5df2\u6709","type":22,"wrap":0},{"text":"441\u5929","type":26,"wrap":0}],[{"text":"KM\u5e73\u53f0\u79ef\u7d2f\u4e86\u8d85\u8fc7","type":22,"wrap":0},{"text":"45\u4e07","type":26,"wrap":0},{"text":"\u7bc7\u5206\u4eab\uff0c","type":22,"wrap":1},{"text":"\u662f\u817e\u8baf\u6700\u5927\u7684\u77e5\u8bc6\u5b9d\u5e93\u3002","type":22,"wrap":1},{"text":"","type":22,"wrap":1},{"text":"\u4f60\u5728KM\u4e0a\u53d1\u8868\u4e86","type":22,"wrap":0},{"text":"28\u7bc7","type":26,"wrap":0},{"text":"\u6587\u7ae0\uff0c","type":22,"wrap":1},{"text":"\u8d85\u8fc7\u4e86","type":22,"wrap":0},{"text":"87%","type":26,"wrap":0},{"text":"\u7684\u540c\u4e8b","type":22,"wrap":0}],[{"text":"\u6bcf\u5929\u6709\u8d85\u8fc72\u4e07\u817e\u8baf\u4eba\u8bbf\u95eeKM\uff0c","type":22,"wrap":1},{"text":"\u6bcf\u6708\u4eba\u5747\u8d85\u8fc7300\u6b21\u8bbf\u95ee\u3002","type":22,"wrap":1},{"text":"","type":22,"wrap":1},{"text":"\u672c\u5e74\u5ea6\u4f60\u5728KM\u6d4f\u89c8\u8fbe\u5230","type":22,"wrap":0},{"text":"20727\u6b21","type":26,"wrap":0},{"text":"\uff0c","type":22,"wrap":1},{"text":"\u8d85\u8fc7","type":22,"wrap":0},{"text":"42%","type":26,"wrap":0},{"text":"\u7684\u540c\u4e8b","type":22,"wrap":0}],[{"text":"\u4e50\u95ee\u662fKM\u6700\u7cbe\u5f69\u7684\u5b50\u793e\u533a\uff0c","type":22,"wrap":1},{"text":"\u6bcf\u5929\u6709\u8d85\u8fc770%\u7684\u540c\u4e8b\u8bbf\u95ee\u3002","type":22,"wrap":1},{"text":"","type":22,"wrap":1},{"text":"\u4f60\u5728\u4e50\u95ee\u4e0a\u53c2\u4e0e\u4e92\u52a8","type":22,"wrap":0},{"text":"104\u6b21","type":26,"wrap":0},{"text":"\uff0c","type":22,"wrap":1},{"text":"\u88ab\u540c\u4e8b\u70b9\u8d5e","type":22,"wrap":0},{"text":"66\u6b21","type":26,"wrap":0}],[{"text":"2011\u5e749\u6708\u624b\u673aKM\u53d1\u5e03\uff0c","type":22,"wrap":1},{"text":"\u6bcf\u592960%\u7684KM\u7528\u6237\u6765\u81ea\u79fb\u52a8\u7aef\u3002","type":22,"wrap":1},{"text":"","type":22,"wrap":1},{"text":"\u4f60\u4ece","type":22,"wrap":0},{"text":"2015\u5e7407\u670814\u65e5","type":26,"wrap":0},{"text":"\u5f00\u59cb\u7528\u624b\u673a\u8bbf\u95eeKM\uff0c","type":22,"wrap":1},{"text":"\u65e9\u4e8e","type":22,"wrap":0},{"text":"23%","type":26,"wrap":0},{"text":"\u7684\u540c\u4e8b","type":22,"wrap":0}]]
            ,
            //第一屏宇航员在设计稿相对于核心内容区的位置（左上角坐标）
            firstScreenAnimation : {
//                astronautPosition : [988,588],
                astronautPosition : [1165,428],
                moveFps : 150,
                suckFps : 50
            },
            finalScreenAnimation : {
               //默认位置为屏幕中间即可
                moveFps : 100,
                outFps : 100
            },
            //bg移动速度
            bgSpeed : 40,
            //当前用户
            currentUser : '皇叔好帅'
        },
        //程序需要用到的全局变量
        globalObjects : {
            //加载的全部图像资源
            imgSour : [],
            //用户对象
            user : [],
            //bg position
            bgPosition : [0,0],
            //屏幕尺寸
            canvasData : {
                width : document.body.clientWidth,
                height : document.body.clientHeight
            },
            //缩放适配后的位置
            adaptInfoPosition : [],
            //屏幕暂停符，用于播放文字动画等。
            stopFlag : 0,
            //屏幕播放到哪一个对话框球体了
            currentText : 0,
            //第一屏相关逻辑参量
            firstScreenAnimation : {
                //第一屏ufo移动终点目标位置
                firstScreenUfoGoal : [],
                //运动速度
                speed : [],
                //是否正在执行第一屏
                inFirstScreen : 0
            },
            finalScreenAnimation : {
                //最后一屏ufo移动终点目标位置
                finalScreenUfoGoal : [],
                //运动速度
                speed : [],
                //是否正在执行最后一屏
                inFinalScreen : 0
            },
            //缩放比例(实际值：设计稿)
            scalingRatio : 0,
            //顶部容错区
            marginTop : 0,
            //是否已扫描
            isScaned : 0
        },
        draw : function(){
            ctx.clearRect(0, 0, canvas.width, canvas.height);
//            for(var i = 0; i < 2; i++) {
//                km8years.user.drawUser([]);
//            }
            km8years.bgMove(km8years.globalObjects.imgSour[3]);
            if(km8years.globalObjects.bgPosition[0] == km8years.source.bgSpeed) {
                //开始首屏动画
                km8years.globalObjects.firstScreenAnimation.inFirstScreen = 1;
                km8years.firstScreenAnimation.firstScreenAnimationInit();
            } else if(km8years.globalObjects.bgPosition[0] == 12000) {
                //开始末屏动画
                km8years.globalObjects.finalScreenAnimation.inFinalScreen = 1;
                km8years.finalScreenAnimation.finalScreenAnimationInit();
            } else {
                km8years.user.ufo.draw(km8years.globalObjects.imgSour[1]);
                km8years.user.drawUser();
                raf = window.requestAnimationFrame(km8years.draw);0
            }
        },
        user : {
            angle : 0,
            //头部摆动方向，1时为逆时针，0为顺时针。
            direction : 1,
            drawUser : function() {
                ctx.save();
                ctx.translate(117 + km8years.source.offset[0], 197 + km8years.source.offset[1]);//中心坐标
                if(km8years.user.direction) {
                    km8years.user.angle += 0.4;
                } else {
                    km8years.user.angle -= 0.4;
                }
                if (Math.abs(km8years.user.angle) >= Math.abs(km8years.source.shakeHeadAngle)) {
                    km8years.user.direction = (km8years.user.direction > 0 ? 0 : 1);
                }
                ctx.rotate(0 - (km8years.user.angle * Math.PI / 180));
                ctx.drawImage(km8years.globalObjects.imgSour[0], -36, -73, 70, 82);
                ctx.fillRect(-2,-2,2,2);
                ctx.restore();
                if(!km8years.globalObjects.finalScreenAnimation.inFinalScreen) {
                km8years.move.borderDetect();
                km8years.move.way();
                }
            },
            ufo : {
                draw : function(back) {
                    ctx.save();
                    if(km8years.globalObjects.finalScreenAnimation.inFinalScreen && km8years.globalObjects.stopFlag >= km8years.source.finalScreenAnimation.moveFps) {
                        ctx.globalAlpha = (3 - km8years.globalObjects.stopFlag / km8years.source.finalScreenAnimation.outFps) > 0 ? (3 - km8years.globalObjects.stopFlag / km8years.source.finalScreenAnimation.outFps) : 0 ;
                    }
                    ctx.drawImage(back,km8years.source.offset[0] + 20, 115 + km8years.source.offset[1],200,200);
                    ctx.restore();
                }
            },
            astronaut : {
                draw : function(back, opicity) {
                    ctx.save();
                    ctx.globalAlpha = opicity;
                    ctx.drawImage(km8years.globalObjects.imgSour[0], km8years.globalObjects.firstScreenAnimation.firstScreenUfoGoal[0] + 69, km8years.globalObjects.firstScreenAnimation.firstScreenUfoGoal[1] + 238, 100, 120);
                    ctx.drawImage(back,parseInt(km8years.globalObjects.firstScreenAnimation.firstScreenUfoGoal[0]) - 60,parseInt(km8years.globalObjects.firstScreenAnimation.firstScreenUfoGoal[1]) + 300);
                    //箭头
                    ctx.drawImage(km8years.globalObjects.imgSour[7], km8years.globalObjects.firstScreenAnimation.firstScreenUfoGoal[0] + 142, km8years.globalObjects.firstScreenAnimation.firstScreenUfoGoal[1] + 220, 30, 30);
                    ctx.font = "16px serif";
                    //2. 使用`fillStyle`设置字体颜色。
                    ctx.fillStyle = "#00AAAA";
                    //3. 使用`fillText()`方法显示字体。
                    ctx.fillText(km8years.source.currentUser, km8years.globalObjects.firstScreenAnimation.firstScreenUfoGoal[0] + 162, km8years.globalObjects.firstScreenAnimation.firstScreenUfoGoal[1] + 225);
                    ctx.restore();
                },
                drawAstronautWithLand : function(back, opicity) {
                    ctx.save();
                    ctx.globalAlpha = opicity;
                    //人头
                    ctx.drawImage(km8years.globalObjects.imgSour[0], km8years.globalObjects.finalScreenAnimation.finalScreenUfoGoal[0] + 72, km8years.globalObjects.finalScreenAnimation.finalScreenUfoGoal[1] + 235, 100, 120);
                    //身子
                    ctx.drawImage(back,parseInt(km8years.globalObjects.finalScreenAnimation.finalScreenUfoGoal[0]) - 410,parseInt(km8years.globalObjects.finalScreenAnimation.finalScreenUfoGoal[1]) + 195);
                    ctx.restore();
                }
            }
        },
        bgMove : function(back) {
            //x轴的移动
            if(km8years.globalObjects.stopFlag == 0 && !km8years.globalObjects.firstScreenAnimation.inFirstScreen && !km8years.globalObjects.finalScreenAnimation.inFinalScreen) {
                km8years.globalObjects.bgPosition[0] += km8years.source.bgSpeed;
            }
            //末位终止
            if(km8years.globalObjects.bgPosition[0] >= 12000) {
                km8years.globalObjects.bgPosition[0] = 12000;
            }
            //每一屏终止一段时间展示文字
            if(km8years.globalObjects.bgPosition[0] % 2000 == 0 && km8years.globalObjects.bgPosition[0] < 12000) {
                km8years.globalObjects.stopFlag ++;
            }
            //屏幕中止150帧
            if(km8years.globalObjects.stopFlag == 150 && !km8years.globalObjects.firstScreenAnimation.inFirstScreen && !km8years.globalObjects.finalScreenAnimation.inFinalScreen) {
                km8years.globalObjects.bgPosition[0] += km8years.source.bgSpeed;
                km8years.globalObjects.stopFlag = 0;
                km8years.globalObjects.currentText ++;
            }

            //画背景图
            ctx.fillStyle = '#060b29'
            ctx.fillRect(0, 0, km8years.globalObjects.canvasData.width, km8years.globalObjects.canvasData.height);
            ctx.drawImage(back,
                    km8years.globalObjects.bgPosition[0], 0,
                    km8years.source.bgShowPerScreen, 1000,
                    0, (km8years.globalObjects.canvasData.height - km8years.globalObjects.canvasData.width/2) / 2,
                    km8years.globalObjects.canvasData.width, km8years.globalObjects.canvasData.width/2
            );
            //画弹窗图
            if(km8years.globalObjects.stopFlag && !km8years.globalObjects.firstScreenAnimation.inFirstScreen && !km8years.globalObjects.finalScreenAnimation.inFinalScreen) {
                drawInfo(km8years.globalObjects.adaptInfoPosition[parseInt((km8years.globalObjects.bgPosition[0] - 2000) / 2000)]);
            }
            //接受一个数组作为相对于内容区的定位,位置应当是设计稿核心内容区的坐标
            function drawInfo (position){
                //剪辑区域
                ctx.save();
                ctx.beginPath();
                ctx.rect(
                        position[0], position[1] ,
                        878, km8years.globalObjects.stopFlag == 0 ? 405 : km8years.globalObjects.stopFlag * 4
                );
                ctx.clip();
                ctx.drawImage(
                    km8years.globalObjects.imgSour[4],
                    0,0,
                    878, km8years.globalObjects.stopFlag * 4,
                    position[0], position[1] ,
                    878, km8years.globalObjects.stopFlag == 0 ? 405 : km8years.globalObjects.stopFlag * 4
                );
                //写出预设字
                //1. 使用`font`设置字体。
                ctx.font = "22px serif";
                //2. 使用`fillStyle`设置字体颜色。
                ctx.fillStyle = "#00AAAA";
                //3.x轴每一行的缓存值（宽度）
                var xPosition = km8years.source.infoLine.marginLeft;
                var yPosition = km8years.source.infoLine.marginTop;
                var afterBig = 0;
                var bigBefor = 0;
                //4. 使用`fillText()`方法显示字体。
                for(var i = 0; i < km8years.source.infotext[km8years.globalObjects.currentText].length; i++) {
                    if (km8years.source.infotext[km8years.globalObjects.currentText][i].type > 22){
                        //放大
                        ctx.save();
                        //1. 使用`font`设置字体。
                        ctx.font = "26px serif";
                        //2. 使用`fillStyle`设置字体颜色。
                        ctx.fillStyle = "#fff";
                        xPosition += bigBefor;
                        ctx.fillText(km8years.source.infotext[km8years.globalObjects.currentText][i].text, position[0] + xPosition, position[1] + yPosition);
                        afterBig = ctx.measureText(km8years.source.infotext[km8years.globalObjects.currentText][i].text).width + 10;
                        ctx.restore();
                    } else {
                        //正常
                        if (afterBig){
                            xPosition += afterBig;
                            afterBig = 0;
                        }
                        bigBefor = ctx.measureText(km8years.source.infotext[km8years.globalObjects.currentText][i].text).width + 5;
                        ctx.fillText(km8years.source.infotext[km8years.globalObjects.currentText][i].text, position[0] + xPosition, position[1] + yPosition);
                    }
                    if (km8years.source.infotext[km8years.globalObjects.currentText][i].wrap){
                        yPosition += km8years.source.infoLine.lineSpacing;
                        xPosition = km8years.source.infoLine.marginLeft;
                        afterBig = 0;
                        bigBefor = 0;
                    }
                }
                ctx.restore();
            }
        },
        move : {
            //x，y是否正向增加，否则为反向
            //这里失效了
            xPluse : 1,
            yPluse : 1,
            way : function() {
                if(km8years.move.xPluse){
                    km8years.source.offset[0]++;
                } else {
                    km8years.source.offset[0]--;
                }
                if(km8years.move.yPluse){
                    km8years.source.offset[1]++;
                } else {
                    km8years.source.offset[1]--;
                }
            },
            borderDetect : function() {
                switch(true)
                {   //碰触上下边界则y方向翻转
                    case km8years.source.offset[1] < 0:
                        km8years.move.yPluse = 1;
                        break;
                    case km8years.source.offset[1] > canvas.height - km8years.source.border[1]:
                        km8years.move.yPluse = 0;
                        break;
                    //碰触左右边界则x方向翻转
                    case km8years.source.offset[0] < km8years.globalObjects.canvasData.width / 2:
                        km8years.move.xPluse = 1;
                        break;
                    case km8years.source.offset[0] > canvas.width - km8years.source.border[0]:
                        km8years.move.xPluse = 0;
                        break;
                }
            }
        },
        //第一屏动画
        firstScreenAnimation : {
            firstScreenAnimationInit : function() {
                //获得目标点
                km8years.globalObjects.firstScreenAnimation.firstScreenUfoGoal = [
                    km8years.globalObjects.canvasData.width * km8years.source.firstScreenAnimation.astronautPosition[0] / km8years.source.bgShowPerScreen - 120,
                    km8years.source.firstScreenAnimation.astronautPosition[1] * km8years.globalObjects.scalingRatio + km8years.globalObjects.marginTop - 195
                ];
                //x轴移动曲线
                km8years.globalObjects.firstScreenAnimation.speed[0] = (km8years.globalObjects.firstScreenAnimation.firstScreenUfoGoal[0] - km8years.source.offset[0]) / km8years.source.firstScreenAnimation.moveFps;
                //y轴移动曲线
                km8years.globalObjects.firstScreenAnimation.speed[1] = (km8years.globalObjects.firstScreenAnimation.firstScreenUfoGoal[1] - km8years.source.offset[1]) / km8years.source.firstScreenAnimation.moveFps;
                //飞到宇航员上头
                km8years.globalObjects.stopFlag = 0;
                km8years.firstScreenAnimation.ufoGoToAstronaut();
            },
            ufoGoToAstronaut : function() {
                //这里后边缓存
                ctx.clearRect(0, 0, canvas.width, canvas.height);
//            for(var i = 0; i < 2; i++) {
//                km8years.user.drawUser([]);
//            }
                ctx.fillStyle = '#060b29';
                ctx.fillRect(0, 0, km8years.globalObjects.canvasData.width, km8years.globalObjects.canvasData.height);
                ctx.drawImage(km8years.globalObjects.imgSour[3],
                        km8years.globalObjects.bgPosition[0], 0,
                        km8years.source.bgShowPerScreen, 1000,
                        0, (km8years.globalObjects.canvasData.height - km8years.globalObjects.canvasData.width/2) / 2,
                        km8years.globalObjects.canvasData.width, km8years.globalObjects.canvasData.width/2
                );
                if(km8years.globalObjects.isScaned) {
                    km8years.bgMove(km8years.globalObjects.imgSour[3]);
                //飞行路径
                    km8years.globalObjects.stopFlag ++;
                    km8years.source.offset[0] += km8years.globalObjects.firstScreenAnimation.speed[0];
                    km8years.source.offset[1] += km8years.globalObjects.firstScreenAnimation.speed[1];
                }
                km8years.user.ufo.draw(km8years.globalObjects.imgSour[1]);
                km8years.user.astronaut.draw(km8years.globalObjects.imgSour[5], 1);
                //吸走宇航员
                if(km8years.globalObjects.stopFlag == km8years.source.firstScreenAnimation.moveFps) {
                    km8years.globalObjects.stopFlag = 0;
                    km8years.firstScreenAnimation.astronautSignInUfo();
                } else {
                    raf = window.requestAnimationFrame(km8years.firstScreenAnimation.ufoGoToAstronaut);
                }
            },
            astronautSignInUfo : function() {
                //这里后边缓存
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                km8years.bgMove(km8years.globalObjects.imgSour[3]);

                km8years.user.ufo.draw(km8years.globalObjects.imgSour[1 + km8years.globalObjects.stopFlag % 2]);
                //正式逻辑
                km8years.globalObjects.stopFlag ++;
                km8years.user.astronaut.draw(km8years.globalObjects.imgSour[5], 1- km8years.globalObjects.stopFlag / km8years.source.firstScreenAnimation.suckFps);
                //至结束
                if(km8years.globalObjects.stopFlag == km8years.source.firstScreenAnimation.suckFps) {
                    //第一屏动画结束，背景移动
                    km8years.globalObjects.bgPosition[0] += km8years.source.bgSpeed;
                    km8years.globalObjects.stopFlag = 0;
                    km8years.globalObjects.firstScreenAnimation.inFirstScreen = 0;
                    km8years.draw();
                } else {
                    raf = window.requestAnimationFrame(km8years.firstScreenAnimation.astronautSignInUfo);

                }
            }
        },
        finalScreenAnimation : {
            finalScreenAnimationInit : function() {
                //这里很多函数可以抽取，后边处理
                //获得目标点
                km8years.globalObjects.finalScreenAnimation.finalScreenUfoGoal = [
                    km8years.globalObjects.canvasData.width / 2 - 100,
                    km8years.globalObjects.canvasData.height / 2 - 330
                ];
                //x轴移动曲线
                km8years.globalObjects.finalScreenAnimation.speed[0] = (km8years.globalObjects.finalScreenAnimation.finalScreenUfoGoal[0] - km8years.source.offset[0]) / km8years.source.finalScreenAnimation.moveFps;
                //y轴移动曲线
                km8years.globalObjects.finalScreenAnimation.speed[1] = (km8years.globalObjects.finalScreenAnimation.finalScreenUfoGoal[1] - km8years.source.offset[1]) / km8years.source.finalScreenAnimation.moveFps;
                //飞到宇航员上头
                km8years.globalObjects.stopFlag = 0;
                km8years.finalScreenAnimation.ufoGoToAstronaut();
            },
            ufoGoToAstronaut : function() {
                //这里后边缓存
                ctx.clearRect(0, 0, canvas.width, canvas.height);
//            for(var i = 0; i < 2; i++) {
//                km8years.user.drawUser([]);
//            }
                ctx.fillStyle = '#060b29'
                ctx.fillRect(0, 0, km8years.globalObjects.canvasData.width, km8years.globalObjects.canvasData.height);
                ctx.drawImage(km8years.globalObjects.imgSour[3],
                        km8years.globalObjects.bgPosition[0], 0,
                        km8years.source.bgShowPerScreen, 1000,
                        0, (km8years.globalObjects.canvasData.height - km8years.globalObjects.canvasData.width/2) / 2,
                        km8years.globalObjects.canvasData.width, km8years.globalObjects.canvasData.width/2
                );
                if(km8years.globalObjects.isScaned) {
                    km8years.bgMove(km8years.globalObjects.imgSour[3]);
                    //飞行路径
                    km8years.globalObjects.stopFlag ++;
                    km8years.source.offset[0] += km8years.globalObjects.finalScreenAnimation.speed[0];
                    km8years.source.offset[1] += km8years.globalObjects.finalScreenAnimation.speed[1];
                }
                km8years.user.ufo.draw(km8years.globalObjects.imgSour[1]);
                km8years.user.drawUser();
                //放出宇航员
                if(km8years.globalObjects.stopFlag == km8years.source.finalScreenAnimation.moveFps) {
                    km8years.globalObjects.stopFlag = 0;
                    km8years.finalScreenAnimation.astronautSignOutUfo();
                } else {
                    raf = window.requestAnimationFrame(km8years.finalScreenAnimation.ufoGoToAstronaut);
                }
            },
            astronautSignOutUfo : function() {
                //这里后边缓存
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                km8years.bgMove(km8years.globalObjects.imgSour[3]);

                km8years.user.ufo.draw(km8years.globalObjects.imgSour[1 + km8years.globalObjects.stopFlag % 2]);
                //正式逻辑
                km8years.globalObjects.stopFlag ++;
                km8years.user.astronaut.drawAstronautWithLand(km8years.globalObjects.imgSour[6], km8years.globalObjects.stopFlag / km8years.source.finalScreenAnimation.outFps);
                //至结束
                raf = window.requestAnimationFrame(km8years.finalScreenAnimation.astronautSignOutUfo);
            }
        },
        init : function() {
            //构建并初始化一些程序参量
                //摆头角度赋值
            km8years.user.angle = km8years.source.shakeHeadAngle;
                //缩放比
            km8years.globalObjects.scalingRatio = km8years.globalObjects.canvasData.width / km8years.source.bgShowPerScreen;
                //y轴的容错,这个值是y轴不显示的上半部分。（此为第一种方案:图片足够高，可以兼容）
//            km8years.globalObjects.bgPosition[1] = km8years.source.bgShowPerScreen / 4 - (km8years.globalObjects.canvasData.height * km8years.source.bgShowPerScreen / km8years.globalObjects.canvasData.width - 1000) / 2;
                //y轴的容错,（此为第二种方案:图片比较窄，在画布上倒上颜色，可以兼容）
            km8years.globalObjects.marginTop = (km8years.globalObjects.canvasData.height - km8years.globalObjects.canvasData.width/2) / 2;
                //初始化弹窗位置数组，改变为相对于屏幕的百分比定位

            for(var i = 0; i < km8years.source.infoPosition.length; i++) {
                km8years.globalObjects.adaptInfoPosition.push(
                    [
                        parseInt(km8years.globalObjects.canvasData.width * km8years.source.infoPosition[i][0] / km8years.source.bgShowPerScreen),
                        parseInt(km8years.globalObjects.canvasData.height * km8years.source.infoPosition[i][1] / 1000)
                    ]
                );
            }
                //加载所有资源
            km8years.globalObjects.imgSour = [];
            var i = 0;
            lodeImg();
            function lodeImg() {
                if( i <= km8years.source.img.length) {
                    var img = new Image();
                    img.src = km8years.source.img[i];
                    img.onload = function() {
                        km8years.globalObjects.imgSour.push(this);
                        if(km8years.globalObjects.imgSour.length == km8years.source.img.length) {
                            window.requestAnimationFrame(km8years.draw);
                        }
                        lodeImg();
                    };
                    i++;
                }
            }
        }
    }
$(function() {
    $('#canvas').attr("width",km8years.globalObjects.canvasData.width);
    $('#canvas').attr("height",km8years.globalObjects.canvasData.height);
    km8years.init();
});


</script>
<script type="text/javascript">
    //tools
    var getMousePosition = function() {
        canvas.addEventListener("click", function __handler__(evt) {
            var x = evt.clientX;
            var y = evt.clientY;
            var rect = canvas.getBoundingClientRect();
            x -= rect.left;
            y -= rect.top;
            console.log(x, y); // (x, y) 就是鼠标在 canvas 单击时的坐标
            km8years.globalObjects.isScaned = 1;
        });
    }
    getMousePosition();
</script>
</body>
</html>
