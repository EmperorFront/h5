Date.prototype.format=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(fmt))fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length));for(var k in o)if(new RegExp("("+k+")").test(fmt))fmt=fmt.replace(RegExp.$1,RegExp.$1.length==1?o[k]:("00"+o[k]).substr((""+o[k]).length));return fmt};var mconsole={logpanel:null,logcontent:null,option:{},init:function(){var self=this;if($("#mconsole_panel").length==0){this.appendCss();var $panel=$(self.getPanel());$("body").append(self.getPanel());self.layout();$(window).resize(function(){self.layout()});$("#mconsole_tabfoot").click(function(e){var tabid=$(e.target).attr("data-tab");$("#mconsole_content").find("div[id^='mconsole_tab_']").hide();$("#mconsole_tab_"+tabid).show();$("#mconsole_tabfoot").find("div.mconsole_tab").removeClass("mconsole_tabcurrent");$(e.target).addClass("mconsole_tabcurrent")});$("#mconsole_logclear").click(function(e){$("#mconsole_log").empty()});$("#mconsole_run").click(function(e){var fun=$("#mconsole_runfun").val();eval(fun)});$("#mconsole_runclear").click(function(e){$("#mconsole_runfun").val("")});$("#mconsole_close").click(function(){$("#mconsole_panel").hide();$("#mconsole_small").show()});$("#mconsole_small").click(function(){$("#mconsole_panel").show();$("#mconsole_small").hide()});$("#mconsole_big").on("doubleTap",function(e){e.stopPropagation();e.preventDefault();var state=$(this).attr("data-state")?parseInt($(this).attr("data-state")):0;if(state==0){$("#mconsole_panel").css({height:"430px"});$("#mconsole_content, #mconsole_logpanel, #mconsole_evrnpanel").css({height:"400px"});$(this).attr("data-state","1")}else{$("#mconsole_panel").css({height:"130px"});$("#mconsole_content, #mconsole_logpanel, #mconsole_evrnpanel").css({height:"100px"});$(this).attr("data-state","0")}self.layout()});self.dragSmall();self.showEnvironment();self.rewriteConsole()}},layout:function(){var height=$(window).height();var width=$(window).width();var $panel=$("#mconsole_panel");$panel.css({top:height-$panel.height()+"px"});$("#mconsole_close").css({left:width-$("#mconsole_close").width()+"px"});$("#mconsole_logclear").css({left:width-$("#mconsole_logclear").width()-20+"px"});$("#mconsole_small").show();$("#mconsole_small").css({top:height-100+"px",left:width-$("#mconsole_small").width()-20+"px"});$("#mconsole_small").hide()},dragSmall:function(){$("#mconsole_small").on("touchmove MSPointerMove pointermove",function(e){e.stopPropagation();e.preventDefault();$("#mconsole_small").css({top:e.touches[0].pageY-25,left:e.touches[0].pageX-25})})},getPanel:function(){var html='<div id="mconsole_panel" class="mconsole_panel" >'+'	 <div id="mconsole_big">'+'		<div id="mconsole_close" class="mconsole_close">-</div>'+'		<div class="mconsole_content" id="mconsole_content">'+'			<div id="mconsole_tab_0">'+'				<div id="mconsole_logpanel" class="mconsole_log"><div id="mconsole_log"></div></div>'+'				<div id="mconsole_logclear" class="mconsole_clear mconsole_btn" >\u6e05\u9664</div>'+"			</div>"+'			<div id="mconsole_tab_1" style="display:none;">			'+'				<div style="width:75%;float:left;">'+'					<textarea id="mconsole_runfun"  style="width:100%;height:85px;margin-left:5px;margin-top:5px;"></textarea>'+"				</div>"+'				<div style="width:60px;float:left;">'+'					<div id="mconsole_run"  class="mconsole_run mconsole_btn">\u8fd0\u884c</div>'+'					<div id="mconsole_runclear"  class="mconsole_run mconsole_btn">\u6e05\u9664</div>'+"				</div>"+"			</div>"+'			<div id="mconsole_tab_2" style="display:none;"> '+'				<div id="mconsole_evrnpanel" class="mconsole_log"><div id="mconsole_evrn"></div></div>'+"         </div>"+"		</div>"+'		<div class="mconsole_footer" id="mconsole_tabfoot">'+'			<div class="mconsole_tab mconsole_tabcurrent" data-tab="0">\u65e5\u5fd7</div>'+'			<div class="mconsole_tab " data-tab="1">\u8fd0\u884c</div>'+'			<div class="mconsole_tab " data-tab="2">\u73af\u5883</div>'+"		</div>"+"   </div>"+"</div>"+'   <div id="mconsole_small" class="mconsole_panelsmall " style="display:none;">MC</div>';return html},appendCss:function(){var style="html,body{ margin:0; padding:0;}"+".mconsole_panel{background:#eee;border:#ccc solid 1px;width:100%;height:130px;display:block;position:fixed; margin:0; padding:0;z-index:49999}"+".mconsole_panelsmall{width:50px;height:50px;border:1px solid #000;-moz-border-radius: 25px;  -webkit-border-radius: 25px;border-radius:25px;left:280px;position:fixed; display:block;margin:0; padding:0;text-align:center;line-height:50px;font-size:25px;background-color:#ccc;-moz-opacity:0.7; opacity:0.7;z-index:50000;}"+".mconsole_content{display:block;width:100%;height:100px;z-index:51000;}"+".mconsole_log{display:block;width:100%;height:100px;overflow:auto;margin:0; padding:0;}"+".mconsole_footer{ width:100%;height:30px;display:block;background-color:#eee;z-index:60000;padding-top: 1px;}"+".mconsole_tab{width:33%;height:30px;float:left;background-color:#eee;text-align:center;line-height:30px;border:#333 solid"+" 1px;box-sizing: border-box;}"+".mconsole_tabcurrent {background-color:#333;color:#fff;}"+".mconsole_close{top:0px;left:295px;width:24px;height:24px;line-height:24px;text-align:center;border:1px solid #000;-moz-border-radius:"+" 12px;-webkit-border-radius: 12px;border-radius:12px;margin-top:-12px;background-color:#444;color:#fff;float:right;position:absolute;}"+".mconsole_clear{left:260px;margin-top:-60px;position:fixed;}"+".mconsole_run{margin-left:15px;margin-top:20px;}"+".mconsole_btn{width:50px;height:24px;line-height:24px;text-align:center;border:1px solid #000;-moz-border-radius: 5px;"+" -webkit-border-radius: 5px; border-radius:5px;background-color:#444;color:#fff;}"+".mconsole_msg{word-break:break-all;margin-top:2px;}";this.loadCss("mconsole_style",style)},loadCss:function(id,style){if($("#"+id).length==0){var newStyle=$('<style id="'+id+'">'+style+"</style>");$("head").append(newStyle)}},rewriteConsole:function(){var self=this;console.log=function(msg){if(typeof msg=="string"){self.log(msg)}else{self.log(JSON.stringify(msg))}};console.debug=function(msg){self.log(msg)};console.info=function(msg){self.info(msg)};console.warn=function(msg){self.error(msg)};console.error=function(msg){self.error(msg)};window.onerror=function(errorMessage,scriptURI,lineNumber,columnNumber,errorObj){self.error(errorMessage+":"+scriptURI+":("+lineNumber+","+columnNumber+")")};var open=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(method,uri,async,user,pass){self.info(method+":"+uri);open.call(this,method,uri,async,user,pass)};var send=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(data){if(data){self.info("Params:"+JSON.stringify(data))}send.call(this,data)}},log:function(msg){var $log=$("#mconsole_log");var $logPanel=$("#mconsole_logpanel");$log.append('<div class="mconsole_msg">'+this.getNow()+"->"+msg+"</div>");if($log.height()>$logPanel.height()){$logPanel.scrollTop($log.height()-$logPanel.height())}},error:function(msg){var $log=$("#mconsole_log");var $logPanel=$("#mconsole_logpanel");$log.append('<div class="mconsole_msg" style="color:red;">'+this.getNow()+"->"+msg+"</div>");if($log.height()>$logPanel.height()){$logPanel.scrollTop($log.height()-$logPanel.height())}},info:function(msg){var $log=$("#mconsole_log");var $logPanel=$("#mconsole_logpanel");$log.append('<div class="mconsole_msg" style="color:blue;">'+this.getNow()+"->"+msg+"</div>");if($log.height()>$logPanel.height()){$logPanel.scrollTop($log.height()-$logPanel.height())}},showEnvironment:function(){var $evrn=$("#mconsole_evrn");var appendEvrn=function(name,text){$("#mconsole_evrn").append('<div class="mconsole_msg"><span  style="font-weight:bold;">'+name+"-></span>"+text+"</div>")};var cookieArray=document.cookie.split(";");var stringCookie=cookieArray.join(";<br>");appendEvrn("URL",document.location.href);appendEvrn("window",$(window).width()+"x"+$(window).height());appendEvrn("Agent",navigator.userAgent);appendEvrn("Cookie",stringCookie)},getNow:function(){return(new Date).format("hh:mm:ss")}};$(function(){mconsole.init()});